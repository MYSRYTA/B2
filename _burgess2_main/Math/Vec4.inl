//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T>::Vec4T() : Eigen::Vector<T, 4>{ Eigen::Vector<T, 4>::Zero( 4 ) }
{}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T>::Vec4T( T val ) : Eigen::Vector<T, 4>( Eigen::Vector<T, 4>::Constant( val ) )
{}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T>::Vec4T( T _x, T _y, T _z, T _t ) : Eigen::Vector<T, 4>(){
	*this << _x, _y, _z, _t;
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T>::Vec4T( const VecT<T>& val ) : Eigen::Vector<T, 4>(){
	if ( val.size() < 4 ){
		*this = Vec4T<T>();
	} else{
		*this << val[0], val[1], val[2], val[3];
	}
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T>::Vec4T( const std::vector<T>& val ) : Eigen::Vector<T, 4>(){
	if ( val.size() < 4 ){
		*this = Vec4T<T>();
	} else{
		*this << val[0], val[1], val[2], val[3];
	}
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T>::Vec4T( const Eigen::Vector<T, 4>& other ) : Eigen::Vector<T, 4>( other )
{}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [0]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T& Vec4T<T>::x(){ return this->Eigen::Vector<T, 4>::x(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [0]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
const T& Vec4T<T>::x()const{ return this->Eigen::Vector<T, 4>::x(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [1]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T& Vec4T<T>::y(){ return this->Eigen::Vector<T, 4>::y(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [1]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
const T& Vec4T<T>::y()const{ return this->Eigen::Vector<T, 4>::y(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [2]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T& Vec4T<T>::z(){ return this->Eigen::Vector<T, 4>::z(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [2]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
const T& Vec4T<T>::z()const{ return this->Eigen::Vector<T, 4>::z(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [3]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T& Vec4T<T>::t(){ return this->Eigen::Vector<T, 4>::w(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [3]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
const T& Vec4T<T>::t()const{ return this->Eigen::Vector<T, 4>::w(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [3]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T& Vec4T<T>::w(){ return this->Eigen::Vector<T, 4>::w(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     [3]へのアクセス
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
const T& Vec4T<T>::w()const{ return this->Eigen::Vector<T, 4>::w(); }

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     Vecへ変換する
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
VecT<T> Vec4T<T>::toVec() const{
	return VecT<T> { std::vector<T>{this->x(), this->y(), this->z(), this->w()} };
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     Typeの配列へ変換する
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
std::vector<T> Vec4T<T>::toTypeArray() const{
	return std::vector<T>{this->x(), this->y(), this->z(), this->w() };
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     デバッグ用の文字列にする　"データ型：[ 値 ]"
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
String Vec4T<T>::toString( const String title ) const{
	String t = title;
	if ( title.length() != 0 ){ t += " : "; }
	return t + "Vec4:[" + GetFloorString( this->x() ) + ", " + GetFloorString( this->y() ) + ", " + GetFloorString( this->z() ) + ", " + GetFloorString( this->w() ) + "]";
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     2つのベクトルの値が全く同じ場合はtrueを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::equal( const Vec4T& other ) const{
	return ( this->x() == other.x() ) && ( this->y() == other.y() ) && ( this->z() == other.z() ) && ( this->w() == other.w() );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     2つのベクトルの値が誤差範囲内で同じ場合はtrueを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::almostEqual( const Vec4T& other, T tolerance ) const{
	return	( std::abs( this->x() - other.x() ) < tolerance ) &&
			( std::abs( this->y() - other.y() ) < tolerance ) &&
			( std::abs( this->z() - other.z() ) < tolerance ) &&
			( std::abs( this->w() - other.w() ) < tolerance );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     ゼロベクトルの場合はtrueを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::isZero() const{
	return this->x() == T( 0.0 ) && this->y() == T( 0.0 ) && this->z() == T( 0.0 ) && this->w() == T( 0.0 );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     値が誤差範囲内でゼロベクトルの場合はtrueを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::almostZero( T tolerance ) const{
	return this->almostEqual( Vec4T<T>( T( 0.0 ) ), tolerance );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     単位ベクトルの場合はtrueを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::isUnit() const{
	return this->lengthSquared() == T( 1.0 );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     誤差範囲内で単位ベクトルの場合はtrueを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::almostUnit( T tolerance ) const{
	return Burgess2MathFn::AlmostEqual( this->lengthSquared(), T( 1.0 ), tolerance );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!		.x .y .zごとに最小値で構成したベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::getMin( const Vec4T& other ) const{
	return Vec4T{	Burgess2MathFn::Min( this->x(), other.x() ), 
					Burgess2MathFn::Min( this->y(), other.y() ), 
					Burgess2MathFn::Min( this->z(), other.z() ), 
					Burgess2MathFn::Min( this->w(), other.w() ) };
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!		.x .y .zごとに最大値で構成したベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::getMax( const Vec4T& other ) const{
	return Vec4T{	Burgess2MathFn::Max( this->x(), other.x() ), 
					Burgess2MathFn::Max( this->y(), other.y() ), 
					Burgess2MathFn::Max( this->z(), other.z() ),
					Burgess2MathFn::Max( this->w(), other.w() ) };
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     .x .y .zごとにlimitの範囲に制限したベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::clamp( const Vec4T& limitVal0, const Vec4T& limitVal1 ) const{
	Vec4T min = limitVal0.getMin( limitVal1 );
	Vec4T max = limitVal0.getMax( limitVal1 );
	return	Vec4T<T> { Burgess2MathFn::Clamp( this->x(), min.x(), max.x() ),
						Burgess2MathFn::Clamp( this->y(), min.y(), max.y() ),
						Burgess2MathFn::Clamp( this->z(), min.z(), max.z() ),
						Burgess2MathFn::Clamp( this->w(), min.w(), max.w() )};
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     t値(0.0~1.0)に基づいて対象ベクトルと線形補間したベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::lerp( const Vec4T& other, T t ) const{
	return *this + ( ( other - *this ) * t );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     t値(0.0~1.0)に基づいて対象ベクトルと線形補間したベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::linearInterpolate( const Vec4T& other, T t ) const{
	return this->lerp( other, t );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     ベクトルの長さの2乗を返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T Vec4T<T>::lengthSquared() const{
	return this->Eigen::Vector<T, 4>::squaredNorm();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     ベクトルの長さを返す (比較のために長さを取得するのであれば.lengthSquared()の値を用いる方が軽量)
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T Vec4T<T>::length() const{
	return this->Eigen::Vector<T, 4>::norm();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     ベクトルの長さの2乗を返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T Vec4T<T>::magnitudeSquared() const{
	return this->lengthSquared();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     ベクトルの長さを返す (比較のために長さを取得するのであれば.magnitudeSquared()の値を用いる方が軽量)
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T Vec4T<T>::magnitude() const{
	return this->length();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     単位ベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::normal() const{
	if ( this->isZero() ){ return *this; }

	return this->Eigen::Vector<T, 4>::normalized();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     単位ベクトルにする
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::setNormal(){
	if ( this->isZero() ){ return; }

	this->Eigen::Vector<T, 4>::normalize();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     単位ベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::unit() const{
	return this->normal();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     単位ベクトルにする
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::setUnit(){
	this->setNormal();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     反転ベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::negate() const{
	return Vec4T{ -this->x(), -this->y(), -this->z(), -this->w() };
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     反転ベクトルにする
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::setNegate(){
	*this = this->negate();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     逆数ベクトルを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::inverse() const{
	if ( this->isZero() ){ return Vec4T<T>(); }

	return Vec4T{ T( 1.0 ) / this->x(), T( 1.0 ) / this->y(), T( 1.0 ) / this->z(), T( 1.0 ) / this->w() };
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     逆数ベクトルにする
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::setInverse(){
	*this = this->inverse();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     内積を返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T Vec4T<T>::dot( const Vec4T& other ) const{
	return this->Eigen::Vector<T, 4>::dot( other );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     2つの位置ベクトルの距離を返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T Vec4T<T>::distanceTo( const Vec4T& other ) const{
	if ( this->almostEqual( other ) ){ return T( 0.0 ); }

	Vec4T<T> d = *this - other;
	return d.length();
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     2つの位置ベクトルの距離が指定した値未満の場合はtrueを返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::distanceLessThan( const Vec4T& other, T dist ) const{
	Vec4T<T> d = *this - other;
	return d.length() < dist;
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     2つのベクトルの間の角度(ラジアン単位)を返す
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T Vec4T<T>::angleTo( const Vec4T& other ) const{
	T dot{ 0.0 };
	if ( this->isUnit() && other.isUnit() ){
		dot = Burgess2MathFn::Clamp( this->dot( other ), T( -1.0 ), T( 1.0 ) );
	} else{
		dot = Burgess2MathFn::Clamp( this->unit().dot( other.unit() ), T( -1.0 ), T( 1.0 ) );
	}

	if ( dot == T( 1.0 ) ){
		return T( 0.0 );
	} else{
		return std::acos( dot );
	}
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T>& Vec4T<T>::operator = ( const Eigen::Vector<T, 4>& other ){
	this->Eigen::Vector<T, 4>::operator=( other );
	return *this;
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
T& Vec4T<T>::operator[]( u8 id ){
	return this->Eigen::Vector<T, 4>::operator[]( id );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
const T& Vec4T<T>::operator[]( u8 id )const{
	return this->Eigen::Vector<T, 4>::operator[]( id );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::operator == ( const Vec4T& other ) const{
	return this->Eigen::Vector<T, 4>::operator==( other );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Bool Vec4T<T>::operator != ( const Vec4T& other ) const{
	return this->Eigen::Vector<T, 4>::operator!=( other );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::operator+( const Vec4T& other )const{
	return this->Eigen::Vector<T, 4>::operator+( other );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::operator+=( const Vec4T& other ){
	this->Eigen::Vector<T, 4>::operator+=( other );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::operator-( const Vec4T& other )const{
	return this->Eigen::Vector<T, 4>::operator-( other );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::operator-=( const Vec4T& other ){
	this->Eigen::Vector<T, 4>::operator-=( other );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::operator*( const T val ) const{
	return this->Eigen::Vector<T, 4>::operator*( val );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::operator*( const Vec4T& other ) const{
	return Vec4T{ this->x() * other.x(), this->y() * other.y(), this->z() * other.z(), this->w() * other.w() };
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::operator*=( const T val ){
	this->Eigen::Vector<T, 4>::operator*=( val );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::operator*=( const Vec4T& other ){
	*this = *this * other;
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::operator/( const T val ) const{
	return this->Eigen::Vector<T, 4>::operator/( val );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
Vec4T<T> Vec4T<T>::operator/( const Vec4T& other ) const{
	return Vec4T<T> { this->x() / other.x(), this->y() / other.y(), this->z() / other.z(), this->w() / other.w() };;
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::operator/=( const T val ){
	this->Eigen::Vector<T, 4>::operator/=( val );
}

//------------------------------------------------------------------------------------------------------------------------------------------------
//!	     
//------------------------------------------------------------------------------------------------------------------------------------------------
template <typename T>
void Vec4T<T>::operator/=( const Vec4T& other ){
	*this = *this / other;
}
